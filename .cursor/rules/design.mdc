---
description: 
globs: 
alwaysApply: true
---
# Design

## ì„¤ê³„ ì›ì¹™

### 1. Event-Driven Architecture
- **ë¹„ë™ê¸° ì²˜ë¦¬**: ê° ì»´í¬ë„ŒíŠ¸ ê°„ ëŠìŠ¨í•œ ê²°í•©
- **í™•ì¥ì„±**: ì´ë²¤íŠ¸ ê¸°ë°˜ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥
- **ë³µì›ë ¥**: ì¥ì•  ì‹œ ê²©ë¦¬ ë° ë³µêµ¬ ìš©ì´

### 2. Infrastructure as Code
- **GitOps**: ëª¨ë“  ì¸í”„ë¼ ì„¤ì •ì„ Gitìœ¼ë¡œ ê´€ë¦¬
- **Helm Charts**: ë²„ì „ ê´€ë¦¬ ë° ì¼ê´€ëœ ë°°í¬
- **Declarative**: ì„ ì–¸ì  ì„¤ì •ìœ¼ë¡œ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ìƒíƒœ

### 3. Container-First Design
- **Immutable**: ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¶ˆë³€ì„± ë³´ì¥
- **Stateless**: ìƒíƒœ ì •ë³´ëŠ” ì™¸ë¶€ ì €ì¥ì†Œì— ë¶„ë¦¬
- **12-Factor App**: í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì„¤ê³„ ì›ì¹™ ì¤€ìˆ˜

## ì•„í‚¤í…ì²˜ íŒ¨í„´

### Workflow Orchestration Pattern
```yaml
# 4-Step DAG íŒ¨í„´
prepare-dataset:
  inputs: [model_tag, dataset_version]
  outputs: [processed_dataset_path]

deepeval-runner:
  depends: [prepare-dataset]
  inputs: [processed_dataset_path, model_endpoint]
  outputs: [deepeval_results.json]

evalchemy-runner:
  depends: [prepare-dataset]
  inputs: [processed_dataset_path, model_endpoint]
  outputs: [evalchemy_results.json]

aggregate-metrics:
  depends: [deepeval-runner, evalchemy-runner]
  inputs: [deepeval_results.json, evalchemy_results.json]
  outputs: [aggregated_metrics.json]
```

### Observer Pattern (ëª¨ë‹ˆí„°ë§)
- **Subject**: Workflow ì‹¤í–‰ ìƒíƒœ
- **Observers**: Prometheus Exporter, Teams Webhook, Grafana
- **Notification**: ìƒíƒœ ë³€í™” ì‹œ ëª¨ë“  ì˜µì €ë²„ì—ê²Œ ì•Œë¦¼

### Strategy Pattern (í‰ê°€ ì „ëµ)
```python
class EvaluationStrategy:
    def evaluate(self, model, dataset): pass

class DeepEvalStrategy(EvaluationStrategy):
    def evaluate(self, model, dataset):
        # Deepeval ë¡œì§

class EvAlchemyStrategy(EvaluationStrategy):
    def evaluate(self, model, dataset):
        # Evalchemy ë¡œì§
```

## ë°ì´í„° ì„¤ê³„

### ë°ì´í„° íŒŒì´í”„ë¼ì¸ íŒ¨í„´
1. **Extract**: ì›ë³¸ ë°ì´í„°ì…‹ ìˆ˜ì§‘
2. **Transform**: ì¤‘ë³µ ì œê±° ë° ì •ê·œí™”
3. **Load**: MinIO ì €ì¥ ë° ë©”íƒ€ë°ì´í„° ë“±ë¡
4. **Validate**: ìŠ¤í‚¤ë§ˆ ê²€ì¦ ë° í’ˆì§ˆ ì²´í¬

### ê²°ê³¼ ë°ì´í„° ëª¨ë¸
```json
{
  "run_id": "uuid",
  "model_tag": "release-0.3.1",
  "timestamp": "2024-01-01T00:00:00Z",
  "deepeval_results": {
    "rag_precision": 0.85,
    "hallucination_rate": 0.12,
    "context_relevance": 0.78
  },
  "evalchemy_results": {
    "arc_easy": 0.75,
    "arc_challenge": 0.42,
    "hellaswag": 0.68,
    "mmlu": 0.58
  },
  "metadata": {
    "dataset_version": "sha256:abc123",
    "evaluation_time_seconds": 3600,
    "gpu_hours": 2.5
  }
}
```

## UI/UX ì„¤ê³„

### Grafana ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ
- **ìƒë‹¨**: ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ë° ìµœì‹  í‰ê°€ ê²°ê³¼
- **ì¤‘ë‹¨**: ì‹œê³„ì—´ ë©”íŠ¸ë¦­ íŠ¸ë Œë“œ (7ì¼, 30ì¼, 90ì¼)
- **í•˜ë‹¨**: ëª¨ë¸ë³„ ìƒì„¸ ë¹„êµ ë° Regression Alert

### Teams ì•Œë¦¼ ì¹´ë“œ ì„¤ê³„
```json
{
  "type": "AdaptiveCard",
  "body": [{
    "type": "TextBlock",
    "text": "ğŸš€ VLLM í‰ê°€ ì™„ë£Œ: release-0.3.1",
    "weight": "Bolder"
  }, {
    "type": "FactSet",
    "facts": [
      {"title": "ì „ì²´ ì ìˆ˜", "value": "78.5% (+2.3%)"},
      {"title": "ì‹¤í–‰ ì‹œê°„", "value": "1h 45m"},
      {"title": "ìƒíƒœ", "value": "âœ… ì„±ê³µ"}
    ]
  }],
  "actions": [{
    "type": "Action.OpenUrl",
    "title": "ìƒì„¸ ë³´ê¸°",
    "url": "https://grafana.company.com/d/vllm-eval"
  }]
}
```

## ì„±ëŠ¥ ìµœì í™” ì„¤ê³„

### ìºì‹± ì „ëµ
- **L1 Cache**: ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ì…‹ ìºì‹œ (Redis)
- **L2 Cache**: ì²˜ë¦¬ëœ ê²°ê³¼ ìºì‹œ (MinIO)
- **L3 Cache**: CDN ê¸°ë°˜ ì •ì  ìì› ìºì‹œ

### ë³‘ë ¬ ì²˜ë¦¬ ì„¤ê³„
- **ë°ì´í„° ë³‘ë ¬ì„±**: ë°ì´í„°ì…‹ ì²­í¬ ë‹¨ìœ„ ë¶„í•  ì²˜ë¦¬
- **ëª¨ë¸ ë³‘ë ¬ì„±**: ì—¬ëŸ¬ GPUë¥¼ í™œìš©í•œ ë™ì‹œ í‰ê°€
- **íŒŒì´í”„ë¼ì¸ ë³‘ë ¬ì„±**: Deepevalê³¼ Evalchemy ë™ì‹œ ì‹¤í–‰

## ë³´ì•ˆ ì„¤ê³„

### Defense in Depth
1. **ë„¤íŠ¸ì›Œí¬**: NetworkPolicy ê¸°ë°˜ íŠ¸ë˜í”½ ì œì–´
2. **ì¸ì¦**: ServiceAccount + RBAC
3. **ì¸ê°€**: OPA Gatekeeper ì •ì±… ì ìš©
4. **ë°ì´í„°**: ì „ì†¡/ì €ì¥ ì‹œ ì•”í˜¸í™”
5. **ê°ì‚¬**: ëª¨ë“  ì‘ì—… ë¡œê·¸ ê¸°ë¡

### Zero Trust ì›ì¹™
- **Never Trust**: ëª¨ë“  ìš”ì²­ ê²€ì¦
- **Always Verify**: ì§€ì†ì ì¸ ì¸ì¦/ì¸ê°€
- **Least Privilege**: ìµœì†Œ ê¶Œí•œ ë¶€ì—¬
